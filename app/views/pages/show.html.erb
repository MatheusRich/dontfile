<% title @page.url %>

<h1>Dontfile</h1>

<div id="container" data-path="<%= @page.url %>">
  <div id="text-area">
    <h2>Text</h2>
    <textarea id="text"><%= @page.content %></textarea>
  </div>

  <h2>File</h2>
  <div id="file-area">
    <div>
      <h4>(Max size: 20mb)</h4>
      <input type="file" id="file" onchange="saveFile()"></input>
    </div>

    <div id="attachment">
      <% if @page.file.attached? %>
        <%= attachment_icon(@page.file_blob.content_type) %>
        <p class="filename"><%= @page.file_blob.filename %></p>

        <%= content_tag :p, class: 'filename-edit-container hidden' do -%>
          <%= text_field_tag 'filename', @page.file_blob.filename.base %>

          <span id="file-extension">
            <%= ".#{@page.file_blob.filename.extension}" %>
          </span>

          <button class="button" type="button" name="update-filename-button" onclick="updateFileName()">
            <%= icon('fas', 'check') %>
          </button>
        <% end -%>

        <div id="buttons">
          <a class="button" title='Download File' href="<%= rails_blob_url(@page.file) %>" download>
            <%= icon('far', 'arrow-alt-circle-down') %>
          </a>

          <%= button_to delete_file_path, method: :delete, params: { url: @page.url }, title: 'Delete File', data: { confirm: "Are you sure?" } do %>
            <%= icon('far', 'trash-alt') %>
          <% end %>

          <button type="button" class="button" onclick="toggleFileNameEditInput(true)">
            <%= icon('far', 'edit') %>
          </button>
        </div>
      <% end %>
    </div>
  </div>
  <progress id="file-upload-progress" value="0"></progress>
</div>
